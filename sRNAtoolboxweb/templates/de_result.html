{% extends "base.html" %}
{% load staticfiles %}


{% block header %}
<script type="text/javascript" src="http://kozea.github.com/pygal.js/javascripts/svg.jquery.js"></script>
<script type="text/javascript" src="http://kozea.github.com/pygal.js/javascripts/pygal-tooltips.js"></script>
<script src="https://cdn.plot.ly/plotly-latest.min.js"></script>
{% endblock %}


{% block content %}
{% load render_table from django_tables2 %}

<div id="page-wrapper">
    <div class="row">
        <div class="col-lg-12">
            <h3 class="page-header">sRNAde Results for job ID: <a href="{{ settings.SUB_SITE }}/jobstatus/{{ id }}" class="alert-link">{{ id }}</a> </h3>
        </div>
        <!-- /.col-lg-12 -->
    </div>
    <!-- /.row -->
    <div class="row">

        <div class="col-lg-8">

            <p class="text-danger">The results will be stored for 15 days (This will be removed on:  {{ date|date:"D d M Y" }}).</p>

            <p class="text-primary">If you use the sRNAde please check <a data-toggle="modal" data-target="#HWTC" >How to Cite.</a></p>

        </div>

        {% if parameters %}
            <div class="col-lg-12">
            <div class="panel panel-primary">
            <div class="panel-heading">
                <h4 class="panel-title">
                    <a data-toggle="collapse" href="#parameters" >Parameters</a>
                </h4>
            </div>
            <!-- .panel-heading -->
            <div id="parameters" class="panel-collapse collapse">
                <div class="panel-body">
                    <div class="col-lg-6">
                        <pre style="white-space: pre-line">
                            {{ parameters }}
                        </pre>
                    </div>
                </div>
            </div>
            </div>
            </div>
        {% endif %}

        <div class="col-lg-12">
            <div class="tab" role="tabpanel" data-example-id="togglable-tabs">
                <ul id="myTab" class="nav nav-tabs">
                    
                    <li role="presentation" class="active"><a href="#tab_summary" data-toggle="tab" aria-expanded="true">Results summary</a>
                    </li>
                    <li role="presentation" class=""><a href="#tab_preprocessing" data-toggle="tab" aria-expanded="false">Preprocessing/QC</a>
                    </li>
                    <li role="presentation" class=""><a href="#tab_mapping_stats" data-toggle="tab" aria-expanded="false">Mapping statistics</a>
                    </li>
                    <li role="presentation" class=""><a href="#tab_mirna_isomir_stats" data-toggle="tab" aria-expanded="false">miRNA and isomiR statistics</a>
                    </li>
                    <li role="presentation" class=""><a href="#tab_de" data-toggle="tab" aria-expanded="false">Differentially expression</a>
                    </li>
                    <li role="presentation" class=""><a href="#tab_seq_variation" data-toggle="tab" aria-expanded="false">Sequence variation</a>
                    </li>
                </ul>

                <!-- Tab panes -->
                <div class="tab-content">

                    <div class="tab-pane fade active in" id="tab_summary" aria-labelledby="tab_summary">
                        <div class="x-content">

                        <div class="panel panel-primary" id="mapping_stats">
                            <div class="panel-heading">
                                <h4 class="panel-title">
                                    <a data-toggle="collapse" href="#mapping_stats_content" >Mapping statistics</a>
                                </h4>
                            </div>
                            <!-- .panel-heading -->
                            <div id="mapping_stats_content" class="panel-collapse collapse in">
                                <div class="panel-body">

                                    <div class="col-lg-12">

                                        <!-- Plots -->
                                        {% if mapping_raw_plot %}
                                            <div style="width:100%; height:100%; padding:1px; border:thin solid black;">
                                                {{ mapping_raw_plot|safe }}
                                            </div>
                                        {% endif %}
                                        <br>
                                        {% if mapping_perc_plot %}
                                            <div style="width:100%; height:100%; padding:1px; border:thin solid black;">
                                                {{ mapping_perc_plot|safe }}
                                            </div>
                                        {% endif %}

                                        <!-- Tables -->
                                        {% if mapping_raw_tab %}
                                        <h3>{{ mapping_raw_tab.name }}</h3>
                                            <div style="overflow: auto; margin-top: auto">
                                                {% render_table mapping_raw_tab.content %}
                                            </div>
                                        {% endif %}

                                        {% if mapping_perc_tab %}
                                        <h3>{{ mapping_perc_tab.name }}</h3>
                                            <div style="overflow: auto; margin-top: auto">
                                                {% render_table mapping_perc_tab.content %}
                                            </div>
                                        {% endif %}

                                        {% if mapping_stat_sensePref_t_tab %}
                                        <h3>{{ mapping_stat_sensePref_t_tab.name }}</h3>
                                            <div style="overflow: auto; margin-top: auto">
                                                {% render_table mapping_stat_sensePref_t_tab.content %}
                                            </div>
                                        {% endif %}

                                        <!--{% if mapping_stat_table %}-->
                                            <!--<h3>{{ mapping_stat_table.name }}</h3>-->
                                            <!--<div style="overflow: auto; margin-bottom: auto">-->
                                                <!--{% render_table mapping_stat_table.content %}-->
                                            <!--</div>-->
                                        <!--{% endif %}-->
                                    <br>
                                    </div>
                                </div>
                            </div>
                        </div>
                        </div>
                        <div class="clearfix"></div>
                    </div>

                    <div class="tab-pane fade active" id="tab_preprocessing" aria-labelledby="tab_summary">
                        <div class="x-content">

                            <div class="panel panel-primary" id="preprocessing_summary">
                                <div class="panel-heading">
                                    <h4 class="panel-title">
                                        <a data-toggle="collapse" href="#summary_content" >Graphic Sequencing Statistics Summary</a>
                                    </h4>
                                </div>
                                <!-- .panel-heading -->
                                <div id="summary_content" class="panel-collapse collapse in">
                                    <div class="panel-body">

                                        <!-- Plots -->
                                        {% if preproc_raw_plot %}
                                            <div style="width:100%; height:100%; padding:1px; border:thin solid black;">
                                                {{ preproc_raw_plot|safe }}
                                            </div>
                                        {% endif %}
                                        <br>
                                        {% if preproc_perc_plot %}
                                            <div style="width:100%; height:100%; padding:1px; border:thin solid black;">
                                                {{ preproc_perc_plot|safe }}
                                            </div>
                                        {% endif %}

                                        <!-- Tables -->
                                        {% if sequencing_stat_table %}
                                        <h3>{{ sequencing_stat_table.name }}</h3>
                                            <div style="overflow: auto; margin-top: auto">
                                                {% render_table sequencing_stat_table.content %}
                                            </div>
                                        {% endif %}

                                        {% if preproc_raw_tab %}
                                        <h3>{{ preproc_raw_tab.name }}</h3>
                                            <div style="overflow: auto; margin-top: auto">
                                                {% render_table preproc_raw_tab.content %}
                                            </div>
                                        {% endif %}

                                        {% if preproc_perc_tab %}
                                        <h3>{{ preproc_perc_tab.name }}</h3>
                                            <div style="overflow: auto; margin-top: auto">
                                                {% render_table preproc_perc_tab.content %}
                                            </div>
                                        {% endif %}

                                        <!--{% if length_plot %}-->
                                            <!--{{ length_plot|safe }}-->
                                        <!--{% endif %}-->

                                    </div>
                                </div>
                            </div>

                            <div class="panel panel-primary" id="preprocessing_read_length">
                                <div class="panel-heading">
                                    <h4 class="panel-title">
                                        <a data-toggle="collapse" href="#read_length_content">Read Length Distribution</a>
                                    </h4>
                                </div>
                                <!-- .panel-heading -->
                                <div id="read_length_content" class="panel-collapse collapse in">
                                    <div class="panel-body">

                                        <!-- Plots -->
                                        {% if read_length_full_plot %}
                                            <div style="width:100%; height:100%; padding:1px; border:thin solid black;">
                                                {{ read_length_full_plot|safe }}
                                            </div>
                                        {% endif %}
                                        <br>
                                        {% if read_length_analysis_plot %}
                                            <div style="width:100%; height:100%; padding:1px; border:thin solid black;">
                                                {{ read_length_analysis_plot|safe }}
                                            </div>
                                        {% endif %}
                                        <br>
                                        {% if read_length_genome_plot %}
                                            <div style="width:100%; height:100%; padding:1px; border:thin solid black;">
                                                {{ read_length_genome_plot|safe }}
                                            </div>
                                        {% endif %}

                                        <!-- Tables -->
                                        {% if read_length_full_t_tab %}
                                        <h3>{{ read_length_full_t_tab.name }}</h3>
                                            <div style="overflow: auto; margin-top: auto">
                                                {% render_table read_length_full_t_tab.content %}
                                            </div>
                                        {% endif %}

                                        {% if read_length_analysis_t_tab %}
                                        <h3>{{ read_length_analysis_t_tab.name }}</h3>
                                            <div style="overflow: auto; margin-top: auto">
                                                {% render_table read_length_analysis_t_tab.content %}
                                            </div>
                                        {% endif %}

                                        {% if genome_mapping_t_tab %}
                                        <h3>{{ genome_mapping_t_tab.name }}</h3>
                                            <div style="overflow: auto; margin-top: auto">
                                                {% render_table genome_mapping_t_tab.content %}
                                            </div>
                                        {% endif %}

                                    </div>
                                </div>
                            </div>

                        </div>
                    </div>

                    <div class="tab-pane fade active" id="tab_mapping_stats" aria-labelledby="tab_summary">
                        <div class="x-content">
                            <div class="col-lg-12">
                                <br>
                                <!-- Plots -->
                                {% if mapping_stat_sensePref_bp_plot %}
                                    <div style="width:100%; height:100%; padding:1px; border:thin solid black;">
                                        {{ mapping_stat_sensePref_bp_plot|safe }}
                                    </div>
                                {% endif %}
                                <br>
                                {% if genome_mapping_bp_plot %}
                                    <div style="width:100%; height:100%; padding:1px; border:thin solid black;">
                                        {{ genome_mapping_bp_plot|safe }}
                                    </div>
                                {% endif %}

                                <!-- Tables -->

                            </div>
                        </div>
                    </div>

                    <div class="tab-pane fade active" id="tab_mirna_isomir_stats" aria-labelledby="tab_summary">
                        <div class="x-content">
                            <div class="col-lg-12">
                                <br>
                                <!-- Plots -->
                                {% if iso_sample_bp_plot %}
                                    <div style="width:100%; height:100%; padding:1px; border:thin solid black;">
                                        {{ iso_sample_bp_plot|safe }}
                                    </div>
                                {% endif %}

                                <!-- Tables -->
                                {% if iso_NTA_A_t_tab %}
                                <h3>{{ iso_NTA_A_t_tab.name }}</h3>
                                    <div style="overflow: auto; margin-top: auto">
                                        {% render_table iso_NTA_A_t_tab.content %}
                                    </div>
                                {% endif %}

                                {% if iso_NTA_U_t_tab %}
                                <h3>{{ iso_NTA_U_t_tab.name }}</h3>
                                    <div style="overflow: auto; margin-top: auto">
                                        {% render_table iso_NTA_U_t_tab.content %}
                                    </div>
                                {% endif %}

                            </div>
                        </div>
                    </div>

                    <div class="tab-pane fade" id="tab_de" aria-labelledby="tab_summary">
                        <div class="x-content">
                        <p>Hi there DE!</p>
                        </div>
                    </div>

                    <div class="tab-pane fade" id="tab_seq_variation" aria-labelledby="tab_summary">
                        <div class="x-content">
                        <p>Hi there sequence variation!</p>
                        </div>
                    </div>

                </div>
            </div>
        </div>
    </div>
</div>

<!-- /.row -->
<!-- /#page-wrapper -->
{% endblock %}


{% block modals %}
{% include "Messages/de/HWTCde.html" %}
{% endblock %}


{% block js %}
<script src="{% static 'js/plugins/dataTables/jquery.dataTables.js' %}"></script>
<script src="{% static 'js/plugins/dataTables/dataTables.bootstrap.js' %}"></script>
<script>
    $('table').each(function() {
        if (this.id != "notformattable"){
            console.log(this.id);
            $(this).dataTable();
        }
    });
</script>

<script>
    $(document).ready(function() {
        if(location.hash) {
            $('a[href=' + location.hash + ']').tab('show');
        }
        $(document.body).on("click", "a[data-toggle]", function(event) {
            location.hash = this.getAttribute("href");
        });
    });
    $(window).on('popstate', function() {
        var anchor = location.hash || $("a[data-toggle=tab]").first().attr("href");
        $('a[href=' + anchor + ']').tab('show');
    });
</script>

{% endblock %}